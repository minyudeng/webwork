<script setup>
import request from '@/axios/request';
import Books from '@/components/Admin/BookShelf/BookList.vue'
import { MyConfirmElMessageBox, MyMessage } from '@/plugins/Message';
import { onMounted, provide, ref } from 'vue';
import { useStore } from 'vuex';

const store = useStore()

onMounted(() => {
    getMyShelfList()
    getCollectionList()
})
//当前是否是自己的书单
const isMine = ref(true)
//shelf
const myShelfList = ref([])
provide('myShelfList', myShelfList)
const nowShelf = ref({
    shelfId: 0,
})
const setNowShlef=(item,bool)=>{
    nowShelf.value.shelfId = item.shelfId
    isMine.value = bool
}
const getMyShelfList = () => {
    request.get('/shelf/get', {
        params: {
            'uid': store.getters.getUserId
        }
    }).then(res => {
        myShelfList.value = res.data
    }).finally(() => {
        options.value = myShelfList.value.map(shelf => ({
            'label': shelf.shelfName,
            'key': shelf.shelfId,
        }))
    })
}
const collectionList = ref([])
const getCollectionList = () => {
    request.get('/book-shelf/get', {
        params: {
            'uid': store.getters.getUserId
        }
    }).then(res => {
        collectionList.value = res.data
    })
}

//delShelf
const delShelf = (shelfId) => {
    MyConfirmElMessageBox('你确定删除这个书架吗', 'warning', () => {
        request.delete('/shelf/del', {
            params: {
                'shelfId': shelfId
            }
        }).then(res => {
            MyMessage('删除成功', 'success')
        }).catch(e => {
            MyMessage('删除失败', 'error')
            console.log(e);
        }).finally(() => {
            getMyShelfList()
            nowShelf.value.shelfId === 0
        })
    })

}
const uncollect = (shelfId1)=>{
    MyConfirmElMessageBox('你确定要取消收藏吗', 'warning', () => {
        collectionShelf(shelfId1)
    })

}
const collectionShelf = (shelfId1) => {
    request.putForm('/shelf/collection', {
        'shelfId': shelfId1,
        'uid': store.getters.getUserId
    }).then(res => {
        MyMessage(res.msg, 'success')
    }).catch(e => {
        console.log(e);
    }).finally(() => {
        location.reload()
    })
}
//dialog
const shelfDialog = ref(false)
const changeShelfDialog = (bool) => {
    shelfDialog.value = bool
}
const logShelf = ref()
const setLogShelf = (shelf2) => {
    changeShelfDialog(true)
    logShelf.value = shelf2
}

const options = ref()
</script>
<template>
    <div id="main">
        <div class="left">
            <Books :shelfId="nowShelf.shelfId"
             :options="options"
             :isMine="isMine"
              v-if="nowShelf"
               :key="nowShelf.shelfId" />
        </div>
        <div class="right">
            <n-collapse>
                <n-collapse-item title="我的书架" name="1">
                    <div class="item" @click="setNowShlef({shelfId : 0},true)" :class="{
                        select: nowShelf.shelfId === 0
                    }">
                        <p>默认书架</p>
                    </div>
                    <div @click="setNowShlef(item,true)" v-for="(item, index) in myShelfList" class="item" :class="{
                        select: nowShelf.shelfId === item.shelfId
                    }">
                        <el-divider border-style="dashed" />
                        <div style="display: flex;justify-content: space-between;">
                            <p>{{ item.shelfName }}</p>
                            <div style="display: flex; align-items: center;">
                                <svg @click="delShelf(item.shelfId)" t="1701669102893" viewBox="0 0 1024 1024" version="1.1"
                                    xmlns="http://www.w3.org/2000/svg" p-id="4222" width="30" height="30">
                                    <path
                                        d="M515.413333 168.675556a128.284444 128.284444 0 0 0-129.137777 125.724444H223.004444a34.133333 34.133333 0 0 0 0 67.982222h37.546667v367.217778c0 67.982222 47.502222 125.724444 105.244445 125.724444h295.822222c56.888889 0 105.244444-56.888889 105.244444-125.724444v-369.777778h34.133334a34.133333 34.133333 0 0 0 0-67.982222h-153.031112a135.964444 135.964444 0 0 0-132.551111-122.311111z m-67.982222 125.724444a69.688889 69.688889 0 0 1 67.982222-64.568889 67.413333 67.413333 0 0 1 67.982223 64.568889z m-81.635555 499.768889c-20.48 0-44.088889-28.444444-44.088889-64.568889v-369.777778h380.586666v366.364445c0 37.262222-23.608889 64.568889-44.088889 64.568889l-292.408888 3.413333z"
                                        fill="#999999" p-id="4223"></path>
                                    <path
                                        d="M409.884444 709.12a31.288889 31.288889 0 0 0 28.444445-34.133333V483.555556a33.28 33.28 0 0 0-28.444445-33.848889 31.004444 31.004444 0 0 0-27.022222 33.848889v190.293333a31.288889 31.288889 0 0 0 27.022222 35.271111z m98.702223 0a31.288889 31.288889 0 0 0 28.444444-34.133333V483.555556a33.28 33.28 0 0 0-28.444444-33.848889 31.004444 31.004444 0 0 0-28.444445 33.848889v190.293333c1.137778 21.617778 11.377778 35.271111 28.444445 35.271111z m102.115555 0a31.288889 31.288889 0 0 0 28.444445-34.133333V483.555556a33.564444 33.564444 0 0 0-28.444445-33.848889 31.004444 31.004444 0 0 0-28.444444 33.848889v190.293333c1.137778 21.617778 11.377778 35.271111 28.444444 35.271111z"
                                        fill="#999999" p-id="4224"></path>
                                </svg>
                                <svg @click="setLogShelf(item)" t="1701839442669" class="icon" viewBox="0 0 1024 1024" version="1.1"
                                    xmlns="http://www.w3.org/2000/svg" p-id="4785" width="20" height="20">
                                    <path
                                        d="M390.97856 521.5488l185.05216-204.5696c-10.01472-22.08768-12.83584-49.792-8.3712-82.56512 4.01408-29.30688 10.96704-51.38432 21.16096-67.0208-11.24352-19.584-16.33792-37.59104-15.52896-54.8096 1.9712-41.74336 22.69696-75.06432 55.43424-89.13408 12.75392-5.45792 27.6992-7.95136 43.24352-7.2192 28.13952 1.32608 54.9632 13.09184 70.016 30.71488 8.66304 10.13248 16.22016 21.7088 22.51264 34.49856l2.2784 0.10752a118.24128 118.24128 0 0 1 35.6096-40.31488c15.73376-11.23328 35.96288-16.88576 56.94976-15.8976 29.69088 1.39776 56.76544 15.88736 72.41728 38.75328 27.06432 39.59808 26.1376 89.02656-2.24256 120.20736a278.144 278.144 0 0 1-11.62752 12.1344c0.35328 0.01024 0.71168 0.0256 1.05984 0.04608 15.82592 0.74752 30.8736 5.53984 44.73344 14.24896 39.68 24.98048 54.73792 68.57728 40.29952 116.62848-13.63456 45.3888-59.88864 68.05504-96.48128 66.33472a78.55104 78.55104 0 0 1-8.0384-0.7936c-7.168-1.06496-14.9248-3.20512-23.49056-6.48192-22.34368 24.22784-47.31904 38.95296-74.36288 43.81696-14.96576 2.688-32.26624 3.58912-51.38944 2.688-14.18752-0.6656-29.80864-2.34496-46.53568-4.99712l-189.91616 205.03552-128.4864 9.77408 5.70368-121.18528z m52.36736 61.42464l44.61056-3.38432 195.75296-211.28192 14.97088 2.78528c19.9936 3.70176 38.20032 5.95968 54.08256 6.7072 15.03744 0.70656 28.1856 0.0768 39.10656-1.87904 18.75968-3.38944 36.98176-16.75776 54.12352-39.73632l13.86496-18.58048 20.7104 10.4704c15.07328 7.63904 23.48032 9.728 27.15648 10.2912 0.69632 0.10752 1.47456 0.1792 2.27328 0.21504 13.29152 0.62976 35.59424-8.65792 41.14432-27.08992 7.2704-24.2176 1.59744-42.41408-16.88064-54.05696-5.7344-3.61472-11.58656-5.50912-17.89952-5.80608-4.20864-0.19968-8.79104 0.32256-13.5936 1.55136l-25.62048 6.528-28.53376-94.464 26.77248-4.60288a214.0928 214.0928 0 0 0 13.32736-13.50656c11.264-12.36992 10.25536-33.21856-2.50368-51.87072-5.84704-8.54016-17.17248-14.20288-29.54752-14.78656-8.48384-0.39936-16.57856 1.67936-22.21568 5.7088-11.29984 8.04864-19.10784 18.7648-23.90528 32.77312l-6.73792 19.59424-77.20448-3.6352-6.38464-16.9984a116.67456 116.67456 0 0 0-20.29056-35.2512c-4.31104-5.04832-16.25088-10.62912-30.5408-11.29984-7.13728-0.3328-13.84448 0.6656-18.88256 2.82624-12.8768 5.5296-21.13024 20.85376-22.08256 40.99072-0.24576 5.26848 1.69984 17.31584 17.536 38.80448l17.65888 23.92576-25.22624 15.8208c-0.42496 0.26624-10.42432 6.97344-16.04608 48.15872-3.85536 28.2112-0.73728 48.70144 9.28256 60.9024l15.0528 18.40128L445.184 543.8976l-1.83808 39.07584z"
                                        p-id="4786" fill="#8a8a8a"></path>
                                    <path
                                        d="M745.77408 350.01856c-51.60448-2.432-91.60704-46.3872-89.17504-97.98656 2.432-51.59936 46.3872-91.60192 97.99168-89.17504 51.59424 2.432 91.5968 46.3872 89.1648 97.98656s-46.3872 91.60704-97.98144 89.17504z m6.46656-137.2672c-24.0896-1.13664-44.61056 17.54112-45.7472 41.63072-1.13664 24.0896 17.54112 44.61056 41.63072 45.7472 24.08448 1.13664 44.60544-17.54112 45.74208-41.63072 1.13152-24.0896-17.54112-44.61056-41.6256-45.7472z"
                                        p-id="4787" fill="#8a8a8a"></path>
                                    <path
                                        d="M956.5696 408.8064c-20.46976 0-37.36064 16.89088-37.36064 37.36064v439.63904c0 34.80576-28.66176 63.46752-63.46752 63.46752H139.2128c-34.80064 0-63.46752-28.66176-63.46752-63.46752V169.28256c0-34.80064 28.66176-63.46752 63.46752-63.46752h384.36864c20.46976 0 37.36064-16.88576 37.36064-37.36064s-16.89088-37.36064-37.36064-37.36064H138.7008C62.44352 31.09376 0 93.02016 0 169.28256V885.8112C0 962.06848 61.93152 1024 138.7008 1024h716.52864c76.2624 0 138.7008-61.93152 138.7008-138.1888V446.17216c0-20.47488-16.89088-37.36576-37.36064-37.36576z"
                                        p-id="4788" fill="#8a8a8a"></path>
                                    <path
                                        d="M210.8672 884.3008h530.23744c20.46976 0 37.36064-16.89088 37.36064-37.36064s-16.89088-37.36064-37.36064-37.36064H210.8672c-20.47488 0-37.36064 16.89088-37.36064 37.36064-0.00512 20.98176 16.37376 37.36064 37.36064 37.36064zM210.8672 732.33408h181.18144c20.47488 0 37.36064-16.89088 37.36064-37.36576s-16.89088-37.36576-37.36064-37.36576H210.8672c-20.47488 0-37.36064 16.89088-37.36064 37.36576s16.37376 37.36576 37.36064 37.36576z"
                                        p-id="4789" fill="#8a8a8a"></path>
                                </svg>
                            </div>
                        </div>
                    </div>
                    <template #header-extra>
                        <svg @click="setLogShelf(null)" t="1701437172460" class="icon" viewBox="0 0 1024 1024" version="1.1"
                            xmlns="http://www.w3.org/2000/svg" p-id="4221" width="18" height="18">
                            <path
                                d="M512 25.6C243.712 25.6 25.6 243.712 25.6 512s218.112 486.4 486.4 486.4 486.4-218.112 486.4-486.4-218.112-486.4-486.4-486.4z m0 896c-225.792 0-409.6-183.808-409.6-409.6s183.808-409.6 409.6-409.6 409.6 183.808 409.6 409.6-183.808 409.6-409.6 409.6z"
                                fill="#B2B2B2" p-id="4222"></path>
                            <path
                                d="M724.48 473.6h-175.104V298.496c0-20.992-17.408-38.4-38.4-38.4s-38.4 17.408-38.4 38.4v175.104H296.96c-20.992 0-38.4 17.408-38.4 38.4s17.408 38.4 38.4 38.4h175.104v175.104c0 20.992 17.408 38.4 38.4 38.4s38.4-17.408 38.4-38.4v-175.104h175.104c20.992 0 38.4-17.408 38.4-38.4 0.512-20.992-16.896-38.4-37.888-38.4z"
                                fill="#B2B2B2" p-id="4223"></path>
                        </svg>
                    </template>
                </n-collapse-item>
                <n-collapse-item title="收藏的书单" name="2">
                    <div @click="setNowShlef(item,false)" v-for="(item, index) in collectionList" class="item"
                        :class="{
                            select: nowShelf.shelfId === item.shelfId
                        }">
                        <el-divider border-style="dashed" />
                        <div style="display: flex;justify-content: space-between;">
                            <p>{{ item.shelfName }}</p>
                            <svg @click="uncollect(item.shelfId)" t="1701669102893" viewBox="0 0 1024 1024" version="1.1"
                                    xmlns="http://www.w3.org/2000/svg" p-id="4222" width="30" height="30">
                                    <path
                                        d="M515.413333 168.675556a128.284444 128.284444 0 0 0-129.137777 125.724444H223.004444a34.133333 34.133333 0 0 0 0 67.982222h37.546667v367.217778c0 67.982222 47.502222 125.724444 105.244445 125.724444h295.822222c56.888889 0 105.244444-56.888889 105.244444-125.724444v-369.777778h34.133334a34.133333 34.133333 0 0 0 0-67.982222h-153.031112a135.964444 135.964444 0 0 0-132.551111-122.311111z m-67.982222 125.724444a69.688889 69.688889 0 0 1 67.982222-64.568889 67.413333 67.413333 0 0 1 67.982223 64.568889z m-81.635555 499.768889c-20.48 0-44.088889-28.444444-44.088889-64.568889v-369.777778h380.586666v366.364445c0 37.262222-23.608889 64.568889-44.088889 64.568889l-292.408888 3.413333z"
                                        fill="#999999" p-id="4223"></path>
                                    <path
                                        d="M409.884444 709.12a31.288889 31.288889 0 0 0 28.444445-34.133333V483.555556a33.28 33.28 0 0 0-28.444445-33.848889 31.004444 31.004444 0 0 0-27.022222 33.848889v190.293333a31.288889 31.288889 0 0 0 27.022222 35.271111z m98.702223 0a31.288889 31.288889 0 0 0 28.444444-34.133333V483.555556a33.28 33.28 0 0 0-28.444444-33.848889 31.004444 31.004444 0 0 0-28.444445 33.848889v190.293333c1.137778 21.617778 11.377778 35.271111 28.444445 35.271111z m102.115555 0a31.288889 31.288889 0 0 0 28.444445-34.133333V483.555556a33.564444 33.564444 0 0 0-28.444445-33.848889 31.004444 31.004444 0 0 0-28.444444 33.848889v190.293333c1.137778 21.617778 11.377778 35.271111 28.444444 35.271111z"
                                        fill="#999999" p-id="4224"></path>
                                </svg>
                        </div>
                    </div>
                </n-collapse-item>
            </n-collapse>

        </div>
    </div>
    <el-dialog v-model="shelfDialog" title="书架设置" width="30%" destroy-on-close>
        <ShelfDialog :changeShelfDialog="changeShelfDialog" :logShelf="logShelf" />
    </el-dialog>
</template>
<style scoped>
#main {
    width: 1200px;
    margin: 10px auto;
    display: flex;
}

#main .left {
    width: 1000px;

}


#main .right {
    width: 200px;
    margin-top: 40px;
}

#main .right .item {
    cursor: pointer;
    color: #333;
}

#main .right .item .el-divider--horizontal {
    margin: 12px 0;
}

#main .right .item {
    color: #666;
    font-weight: 500;
    transition: all 0.3s ease;
}

#main .right .item:hover {
    color: rgb(174, 221, 136);
}

#main .right .item.select {
    color: rgb(136, 202, 82);
}</style>